---
sidebar_position: 3
sidebar_label: "ğŸ› ï¸ Travaux Pratiques"
---

# ğŸ› ï¸ TP : Navigation avec TurtleBot3

## Partie 1 â€” Mise en route du TurtleBot3 et tÃ©lÃ©opÃ©ration

:::caution Configuration rÃ©seau
Avant toute manipulation, assurez-vous que votre **PC (Remote PC)** et votre **TurtleBot3** est connectÃ© au mÃªme rÃ©seau.
:::

:::tip Ã‰vitez les conflits rÃ©seau entre groupes
ROS 2 utilise un systÃ¨me de communication basÃ© sur le multicast.  
Si **deux groupes** utilisent la **mÃªme configuration rÃ©seau** (mÃªme `ROS_DOMAIN_ID`, mÃªme nom d'hÃ´te, etc.), cela provoque des interfÃ©rences entre leurs robots : tÃ©lÃ©opÃ©ration instable, messages croisÃ©s, contrÃ´les partagÃ©s...

Pour Ã©viter cela, chaque groupe doit utiliser un `ROS_DOMAIN_ID` unique et un nom d'hÃ´te diffÃ©rent.

ğŸ’» ğŸ¤– Ajoutez la ligne suivante dans le fichier `~/.bashrc` de votre **PC** *et* du **TurtleBot3** :
```bash
export ROS_DOMAIN_ID=<votre_numÃ©ro_de_groupe>
```

ğŸ¤– Pour changer le nom d'hote du robot :
```bash
sudo hostnamectl set-hostname burger_<votre_numÃ©ro_de_groupe>
```
:::

### ğŸ¤– 1. Bringup du robot (TB3)

:::info PrÃ©requis Ã  lâ€™installation

Avant de commencer, assurez-vous que le TurtleBot3 est correctement configurÃ© avec lâ€™image systÃ¨me recommandÃ©e et que toutes les dÃ©pendances nÃ©cessaires pour ROS 2 sont bien installÃ©es sur les deux machines.

- ğŸ’» [Instructions pour votre PC](../install/pc#turtlebot-3-burger-robotis)  
- ğŸ¤– [Instructions pour le TurtleBot3](../install/turtlebot)
:::

:::note
Le terminal doit rester ouvert pendant toute la session avant de continuer les manipulations suivantes.
:::

ğŸ¤– Sur le TurtleBot3 (via SSH), lancez :
```
ros2 launch turtlebot3_bringup robot.launch.py use_sim_time:=False
```

### ğŸ® 2. TÃ©lÃ©opÃ©ration clavier

ğŸ’» Depuis votre PC, ouvrez un nouveau terminal et lancez :
```bash
ros2 run turtlebot3_teleop teleop_keyboard
```

Gardez le terminal sÃ©lectionnÃ© (focus) pour pouvoir envoyer les commandes. 
Vous pouvez :
- Avancer, reculer
- Tourner Ã  gauche / droite
- Quittez avec Ctrl+C une fois les tests terminÃ©s

##### âœ… Ã€ vÃ©rifier :

- Le robot se dÃ©place bien dans les quatre directions
- Le dÃ©lai de rÃ©action est faible
- Aucune perte de connexion

## ğŸ—ºï¸ Partie 2 â€” CrÃ©ation de la carte avec Cartographer

Nous allons crÃ©er une **carte de lâ€™environnement** dans lequel votre TurtleBot3 Ã©voluera.  
Celle-ci sera utilisÃ©e pour la navigation autonome.

### ğŸ§­ 1. Lancer le systÃ¨me de cartographie

ğŸ’» Sur **votre PC**, ouvrez un terminal et lancez :
```bash
ros2 launch turtlebot3_cartographer cartographer.launch.py use_sim_time:=False
```

Cela dÃ©marre automatiquement :
- ğŸ§  Le systÃ¨me SLAM (Simultaneous Localization and Mapping)
- ğŸ–¥ï¸ RViz pour la visualisation en temps rÃ©el
- ğŸ“¡ La rÃ©cupÃ©ration des donnÃ©es LIDAR

Vous devriez voir (voir image ci-dessous) :
- âœ… Le repÃ¨re du robot (en vert et rouge)
- ğŸ“ Les points du LIDAR (en noir)
- ğŸ§± La carte grise qui se construit progressivement

<p align="center">
  <img src="/img/navigation/cartographer.png" alt="Cartographer dans RViz" width="400" />
</p>

### ğŸš¶â€â™‚ï¸ 2. DÃ©placement du robot pour cartographier

ğŸ’» Dans un nouveau terminal, lancez la tÃ©lÃ©opÃ©ration :

```bash
ros2 run turtlebot3_teleop teleop_keyboard
```

Gardez ce terminal sÃ©lectionnÃ© (fenÃªtre active) pour envoyer les commandes clavier.  
â¡ï¸ Faites circuler doucement le robot pour couvrir toute la piÃ¨ce.

> La carte est gÃ©nÃ©rÃ©e en temps rÃ©el grÃ¢ce au SLAM.  
> Plus vous explorez, plus la carte devient prÃ©cise.

:::warning ğŸš« Ne quittez pas RViz ou le terminal !
La carte nâ€™est pas sauvegardÃ©e automatiquement. Tous les processus doivent rester actifs jusquâ€™Ã  la sauvegarde.
:::

### ğŸ’¾ 3. Sauvegarder la carte

Une fois satisfait de la cartographie, sauvegardez-la :

ğŸ’» Dans un terminal, exÃ©cutez :

```bash
mkdir ~/map 
ros2 run nav2_map_server map_saver_cli -f ~/map/map_workshop
```

ğŸ—‚ï¸ Cela crÃ©era :
- Un fichier `map_workshop.pgm` contenant l'image de la carte
- Un fichier `map_workshop.yaml` contenant les mÃ©tadonnÃ©es de la carte

> âœ… Vous pouvez maintenant fermer tous les terminaux, sauf celui du bringup du robot, qui doit rester actif.

## Partie 3 â€” Navigation autonome avec Nav2

ğŸ’» Lancez le commande suivante pour lancer la localisation et la navigation autonome :
```bash 
ros2 launch turtlebot3_navigation2 navigation2.launch.py map:=$HOME/map/map_workshop.yaml use_sim_time:=False
```

ğŸ‘€ Sur RViz vous devez voir le robot, les scans du LIDAR, les particules de AMCL et la carte que vous avez enregistrÃ©e.

ğŸ“ Si le robot est mal localisÃ©, utilisez l'outil *2D Pose Estimate* sur RViz. Cliquez et Glissez avec la souris pour positionner le robot sur la carte.

ğŸ“ Pour donner des ordres de navigation, utilisez l'outil *Nav2 Goal* sur RViz. Cliquez et Glissez avec la souris sur la carte lÃ  oÃ¹ le robot doit aller.

## ğŸ§ª Partie 4 â€” TP : Exploration autonome

ğŸ¯ **Objectif** : Programmer le robot pour quâ€™il suive une sÃ©quence de **2 Ã  3 points de passage**, comme lors dâ€™une patrouille, avec un **retour automatique au point de dÃ©part**.

ğŸ“¥ TÃ©lÃ©chargez le [fichier Python du TP](/files/go_to.py) ci-dessous, puis **modifiez-le** pour rÃ©pondre aux objectifs de la patrouille.

Si vous souhaitez identifier les points de passage Ã  utiliser, vous pouvez vous servir de la fonctionnalitÃ© `Publish Point` dans RViz. 
Un simple survol dans la scÃ¨ne affichera les coordonnÃ©es du point sÃ©lectionnÃ©, en bas de l'interface.

## ğŸ–¥ï¸ Simulation du TurtleBot3 dans Gazebo

:::warning
ğŸ’¡ Ã€ faire uniquement si vous **n'avez pas de TurtleBot3 physique**.
:::

### 1. Installer les dÃ©pendances

```bash
cd ~/ros_workshop_ws/src
git clone -b jazzy https://github.com/ROBOTIS-GIT/turtlebot3_simulations.git

cd ~/ros_workshop_ws
colcon build --symlink-install
```

### 2. Lancer la simulation dans Gazebo

```bash
ros2 launch turtlebot3_gazebo turtlebot3_world.launch.py
```

Une fois la simulation lancÃ©e, vous pouvez utiliser :
- la tÃ©lÃ©opÃ©ration
- la navigation autonome

:::tip 
ğŸ•’ N'oubliez pas dâ€™ajouter `use_sim_time:=true` lors du lancement des commandes la navigation pour synchroniser le temps simulÃ©.
:::
